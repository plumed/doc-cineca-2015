<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>PLUMED: MATHEVAL</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed-code.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.3.0-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home&#160;(cineca-2015)</span></a></li>
      <li><a href="_syntax.html"><span>Getting&#160;started</span></a></li>
      <li><a href="tutorials.html"><span>Tutorials</span></a></li>
      <li><a href="glossary.html"><span>Index&#160;of&#160;Actions</span></a></li>
      <li><a href="cineca.html"><span>Cineca</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_m_a_t_h_e_v_a_l.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MATHEVAL </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><table  align="center" frame="void" width="95%%" celpadding="5%%">
<tr>
<td width="70%%"></td><td><b> This is part of the function <a class="el" href="mymodules.html">module </a></b>   </td></tr>
</table>
<p>Calculate a combination of variables using a matheval expression.</p>
<p>This action computes an arbitrary function of one or more precomputed collective variables. Arguments are chosen with the ARG keyword, and the function is provided with the FUNC string. Notice that this string should contain no space. Within FUNC, one can refer to the arguments as x,y,z, and t (up to four variables provided as ARG). This names can be customized using the VAR keyword (see examples below).</p>
<p>If you want a function that depends not only on collective variables but also on time you can use the <a class="el" href="_t_i_m_e.html">TIME</a> action.</p>
<dl class="section attention"><dt>Attention</dt><dd>The MATHEVAL object only works if libmatheval is installed on the system and PLUMED has been linked to it</dd></dl>
<dl class="section user"><dt>Compulsory keywords</dt><dd></dd></dl>
<table  align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> ARG </b> </td><td>the input for this action is the scalar output from one or more other actions. The particular scalars that you will use are referenced using the label of the action. If the label appears on its own then it is assumed that the Action calculates a single scalar value. The value of this scalar is thus used as the input to this new action. If * or *.* appears the scalars calculated by all the proceding actions in the input file are taken. Some actions have multi-component outputs and each component of the output has a specific label. For example a <a class="el" href="_d_i_s_t_a_n_c_e.html">DISTANCE</a> action labelled dist may have three componets x, y and z. To take just the x component you should use dist.x, if you wish to take all three components then use dist.*.More information on the referencing of Actions can be found in the section of the manual on the PLUMED <a class="el" href="_syntax.html">Getting started</a>. Scalar values can also be referenced using POSIX regular expressions as detailed in the section on <a class="el" href="_regex.html">Regular Expressions</a>. To use this feature you you must compile PLUMED with the appropriate flag.   </td></tr>
<tr>
<td width="15%"><b> PERIODIC </b> </td><td>if the output of your function is periodic then you should specify the periodicity of the function. If the output is not periodic you must state this using PERIODIC=NO   </td></tr>
<tr>
<td width="15%"><b> FUNC </b> </td><td>the function you wish to evaluate   </td></tr>
</table>
<dl class="section user"><dt>Options</dt><dd></dd></dl>
<table  align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> NUMERICAL_DERIVATIVES </b> </td><td><p class="starttd">( default=off ) calculate the derivatives for these quantities numerically  </p>
<p class="endtd"></p>
</td></tr>
</table>
<table  align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> VAR </b> </td><td><p class="starttd">the names to give each of the arguments in the function. If you have up to three arguments in your function you can use x, y and z to refer to them. Otherwise you must use this flag to give your variables names.  </p>
<p class="endtd"></p>
</td></tr>
</table>
<dl class="section user"><dt>Examples</dt><dd></dd></dl>
<p>The following input tells plumed to perform a metadynamics using as a CV the difference between two distances. </p><pre class="fragment">dAB: DISTANCE ARG=10,12
dAC: DISTANCE ARG=10,15
diff: MATHEVAL ARG=dAB,dAC FUNC=y-x PERIODIC=NO
# notice: the previous line could be replaced with the following
# diff: COMBINE ARG=dAB,dAC COEFFICIENTS=-1,1
METAD ARG=diff WIDTH=0.1 HEIGHT=0.5 BIASFACTOR=10 PACE=100
</pre><p> (see also <a class="el" href="_d_i_s_t_a_n_c_e.html">DISTANCE</a>, <a class="el" href="_c_o_m_b_i_n_e.html">COMBINE</a>, and <a class="el" href="_m_e_t_a_d.html">METAD</a>). Notice that forces applied to diff will be correctly propagated to atoms 10, 12, and 15. Also notice that since MATHEVAL is used without the VAR option the two arguments should be referred to as x and y in the expression FUNC. For simple functions such as this one it is possible to use <a class="el" href="_c_o_m_b_i_n_e.html">COMBINE</a>, which does not require libmatheval to be installed on your system.</p>
<p>The following input tells plumed to print the angle between vectors identified by atoms 1,2 and atoms 2,3 its square (as computed from the x,y,z components) and the distance again as computed from the square root of the square. </p><pre class="fragment">DISTANCE LABEL=d1 ATOMS=1,2 COMPONENTS
DISTANCE LABEL=d2 ATOMS=2,3 COMPONENTS
MATHEVAL ...
  LABEL=theta
  ARG=d1.x,d1.y,d1.z,d2.x,d2.y,d2.z
  VAR=ax,ay,az,bx,by,bz
  FUNC=acos((ax*bx+ay*by+az*bz)/sqrt((ax*ax+ay*ay+az*az)*(bx*bx+by*by+bz*bz))
  PERIODIC=NO
... MATHEVAL
PRINT ARG=theta
</pre><p> (See also <a class="el" href="_p_r_i_n_t.html">PRINT</a> and <a class="el" href="_d_i_s_t_a_n_c_e.html">DISTANCE</a>).</p>
<p>Notice that the matheval library implements a large number of functions (trigonometric, exp, log, etc). Among the useful functions, have a look at the step function (that is the Heaviside function). <code>step(x)</code> is defined as 1 when <code>x</code> is positive and <code>0</code> when x is negative. This allows for a straightforward implementation of if clauses.</p>
<p>For example, imagine that you want to implement a restraint that only acts when a distance is larger than 0.5. You can do it with </p><pre class="fragment">d: DISTANCE ATOMS=10,15
m: MATHEVAL ARG=d FUNC=0.5*step(0.5-x)+x*step(x-0.5) PERIODIC=NO
# check the function you are applying:
PRINT ARG=d,n FILE=checkme
RESTRAINT ARG=d AT=0.5 KAPPA=10.0
</pre><p> (see also <a class="el" href="_d_i_s_t_a_n_c_e.html">DISTANCE</a>, <a class="el" href="_p_r_i_n_t.html">PRINT</a>, and <a class="el" href="_r_e_s_t_r_a_i_n_t.html">RESTRAINT</a>)</p>
<p>The meaning of the function <code>0.5*step(0.5-x)+x*step(x-0.5)</code> is:</p><ul>
<li>If x&lt;0.5 (step(0.5-x)!=0) use 0.5</li>
<li>If x&gt;0.5 (step(x-0.5)!=0) use x Notice that the same could have been obtained using an <a class="el" href="_u_p_p_e_r__w_a_l_l_s.html">UPPER_WALLS</a> However, with MATHEVAL you can create way more complex definitions.</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>If you apply forces on the variable (as in the previous example) you should make sure that the variable is continuous! Conversely, if you are just analyzing a trajectory you can safely use discontinuous variables.</dd></dl>
<p>A possible continuity check with gnuplot is </p><pre class="fragment"># this allow to step function to be used in gnuplot:
gnuplot&gt; step(x)=0.5*(erf(x*10000000)+1)
# here you can test your function
gnuplot&gt; p 0.5*step(0.5-x)+x*step(x-0.5)
</pre><p>Also notice that you can easily make logical operations on the conditions that you create. The equivalent of the AND operator is the product: <code>step(1.0-x)*step(x-0.5)</code> is only equal to 1 when x is between 0.5 and 1.0. By combining negation and AND you can obtain an OR. That is, <code>1-step(1.0-x)*step(x-0.5)</code> is only equal to 1 when x is outside the 0.5-1.0 interval. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="colvarintro.html">Collective variables</a></li><li class="navelem"><a class="el" href="_function.html">Functions</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
