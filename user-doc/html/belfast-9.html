<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>PLUMED: Belfast tutorial: NMR constraints</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed-code.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.3.0-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home&#160;(cineca-2015)</span></a></li>
      <li><a href="_syntax.html"><span>Getting&#160;started</span></a></li>
      <li><a href="tutorials.html"><span>Tutorials</span></a></li>
      <li><a href="glossary.html"><span>Index&#160;of&#160;Actions</span></a></li>
      <li><a href="cineca.html"><span>Cineca</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('belfast-9.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Belfast tutorial: NMR constraints </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="belfast-9-aim"></a>
Aims</h1>
<p>This tutorial is about the use of experimental data, in particular NMR data, either as collective variables or as replica-averaged restraints in MD simulations. While the first is a just a simple extension of what we have been already doing in previous tutorials, the latter is an approach that can be used to increase the quality of a force-field in describing the properties of a specific system.</p>
<h2><a class="anchor" id="belfast-9-lo"></a>
Learning Outcomes</h2>
<p>Once this tutorial is completed students will:</p><ul>
<li>know why and how to use experimental data to define a collective variable</li>
<li>know why and how to use experimental data as replica-averaged restraints in MD simulations</li>
</ul>
<h1><a class="anchor" id="belfast-9-res"></a>
Resources</h1>
<p>The <a href="tutorial-resources/belfast-9a.tar.gz" download="belfast-9a.tar.gz">tarball </a> for this project contains the following:</p><ul>
<li>system: the files use to generate the topol?.tpr files of the first and second example</li>
<li>first: an example on the use of chemical shifts as a collective variable</li>
<li>second: an example on the use of chemical shifts as replica-averaged restraints</li>
<li>third: an example on the use of RDCs (calculated with the theta-method) as replica-averaged restrains</li>
</ul>
<h1><a class="anchor" id="belfast-9-ins"></a>
Instructions</h1>
<h2><a class="anchor" id="belfast-9-expdata"></a>
Experimental data as Collective Variables</h2>
<p>In the former tutorials it has been often discussed the possibility of measuring a distance with respect to a structure representing some kind of state for a system, i.e. <a class="el" href="belfast-5.html">Belfast tutorial: Out of equilibrium dynamics</a>. An alternative possibility is to use as a reference a set of experimental data that represent a state and measure the current deviation from the set. In plumed there are currently implemented the following NMR experimental observables: Chemical Shifts (only for proteins) <a class="el" href="_c_s2_b_a_c_k_b_o_n_e.html">CS2BACKBONE</a> and <a class="el" href="_c_h3_s_h_i_f_t_s.html">CH3SHIFTS</a>, <a class="el" href="_n_o_e.html">NOE</a> distances and Residual Dipolar couplings <a class="el" href="_r_d_c.html">RDC</a>. In addition <a class="el" href="_n_o_e.html">NOE</a> collective variable can be also used for PRE distances and 3J Couplings can be implemented using <a class="el" href="_t_o_r_s_i_o_n.html">TORSION</a> and <a class="el" href="_m_a_t_h_e_v_a_l.html">MATHEVAL</a>. Among the above listed collective variables those based on chemical shifts make use of an external library, ALMOST, that must be downloaded and compiled separately. In addition plumed must be configured in such a way to link ALMOST. Detailed instructions on how to compile PLUMED with ALMOST can be found in <a class="el" href="_c_s2_b_a_c_k_b_o_n_e.html">CS2BACKBONE</a>.</p>
<p>In the following we will write the CS2BACKBONE collective variable that has been used in Gratana et al. (2013).</p>
<pre class="fragment">prot: GROUP ATOMS=1-862
WHOLEMOLECULES ENTITY0=prot

cs: CS2BACKBONE ATOMS=prot DATA=data FF=a03_gromacs.mdb NRES=56 FLAT=1.0 WRITE_CS=50 

PRINT ARG=cs FILE=COLVAR STRIDE=100

ENDPLUMED
</pre><p>In this case the chemical shifts are those measured for the native state of the protein and can be used, together with other CVs and Bias-Exchange Metadynanics, to guide the system back and forth from the native structure. The experimental chemical shifts are in six files inside the "data/" folder (see first example in the resources tarball), one file for each nucleus. A 0 chemical shift is used where a chemical shift doesn't exist (i.e. CB of GLY) or where it has not been assigned. Additionally the data folder contains:</p>
<ul>
<li>camshift.db: this file is a parameter file for camshift, it is a standard file needed to calculate the chemical shifts from a structure</li>
<li>a03_gromacs.mdb: this is a Amber force field in ALMOST format and it is used to map the atom names from plumed and almost (in this case we are using amber for our simulation)</li>
<li>template.pdb: this is a pdb file for the protein we are simulating (i.e. editconf -f conf.gro -o template.pdb) where atoms are ordered in the same way in which are included in the main code and again it is used to map the atom in plumed with those in almost.</li>
</ul>
<p>This example can be executed as</p>
<pre class="fragment">mdrun_mpi -s topol -plumed plumed
</pre><h2><a class="anchor" id="belfast-9-replica"></a>
Replica-Averaged Restrained Simulations</h2>
<p>NMR data, as all the equilibrium experimental data, are the result of a measure over an ensemble of structures and over time. In principle a "perfect" molecular dynamics simulations, that is a simulations with a perfect force-field and a perfect sampling can predict the outcome of an experiments in a quantitative way. Actually in most of the cases obtaining a qualitative agreement is already a fortunate outcome. In order to increase the accuracy of a force field in a system dependent manner it is possible to add to the force-field an additional term based on the agreement with a set of experimental data. This agreement is not enforced as a simple restraint because this would mean to ask the system to be always in agreement with all the experimental data at the same time, instead the restraint is applied over an AVERAGED COLLECTIVE VARIABLE where the average is performed over multiple identical simulations. In this way the is not a single replica that must be in agreement with the experimental data but they should be in agreement on average. It has been shown that this approach is equivalent in solving the problem of finding a modified version of the force field that will reproduce the provided set of experimental data withouth any additional assumption on the data themselves.</p>
<p>Currently ENSEMBLE AVERAGING of a collective variable can be performed only using the NMR variables (<a class="el" href="_c_s2_b_a_c_k_b_o_n_e.html">CS2BACKBONE</a>, <a class="el" href="_c_h3_s_h_i_f_t_s.html">CH3SHIFTS</a>, <a class="el" href="_n_o_e.html">NOE</a> and <a class="el" href="_r_d_c.html">RDC</a>).</p>
<p>The second example included in the resources show how the amber force field can be improved in the case of protein domain GB3 using the native state chemical shifts a replica-averaged restraint. By the fact that replica-averaging needs the use of multiple replica simulated in parallel in the same conditions it is easily complemented with BIAS-EXCHANGE or MULTIPLE WALKER metadynamics to enhance the sampling.</p>
<pre class="fragment">prot: GROUP ATOMS=1-862
WHOLEMOLECULES ENTITY0=prot

cs: CS2BACKBONE ATOMS=prot DATA=data FF=a03_gromacs.mdb NRES=56 FLAT=0.0 WRITE_CS=500 ENSEMBLE

cse: RESTRAINT ARG=cs AT=0. KAPPA=0. SLOPE=24

PRINT ARG=cs FILE=COLVAR STRIDE=10

ENDPLUMED
</pre><p>with respect to the case in which chemical shifts are used to define a standard collective variable, in this case the keyword ENSEMBLE tells plumed to calculate all the chemical shifts from the replicas (i.e. 4 replicas) average them and only after the averaging calculate the difference with respect to the experimental ones. On this difference that is the AVERAGED Collective Variable it is possible to apply a linear <a class="el" href="_r_e_s_t_r_a_i_n_t.html">RESTRAINT</a> (because the variable is already a sum of squared differences) that is the new term we are adding to the underlying force field.</p>
<p>This example can be executed as </p><pre class="fragment">mpiexec -np 4 mdrun_mpi -s topol -plumed plumed -multi 4
</pre><p>The third example show how <a class="el" href="_r_d_c.html">RDC</a> (calculated with the theta-methods) can be employed in the same way, in this case to describe the native state of Ubiquitin. In particular it is possible to observe how the RDC averaged restraint applied on the correlation between the calculated and experimental N-H and CA-HA RDCs result in the increase of the correlation of the RDCs for other bonds already on a very short time scale.</p>
<pre class="fragment">RDC ...
ENSEMBLE
CORRELATION
GYROM=-72.5388
SCALE=0.001060 
ATOMS1=20,21 COUPLING1=8.17
ATOMS2=37,38 COUPLING2=-8.271
ATOMS3=56,57 COUPLING3=-10.489
ATOMS4=76,77 COUPLING4=-9.871
#continue....
</pre><p>In this input the first four N-H RDCs are defined.</p>
<p>This example can be executed as </p><pre class="fragment">mpiexec -np 8 mdrun_mpi -s topol -plumed plumed -multi 8
</pre><h1><a class="anchor" id="belfast-9-refer"></a>
Reference</h1>
<ol type="1">
<li>Granata, D., Camilloni, C., Vendruscolo, M. &amp; Laio, A. Characterization of the free-energy landscapes of proteins by NMR-guided metadynamics. Proc. Natl. Acad. Sci. U.S.A. 110, 6817–6822 (2013).</li>
<li>Cavalli, A., Camilloni, C. &amp; Vendruscolo, M. Molecular dynamics simulations with replica-averaged structural restraints generate structural ensembles according to the maximum entropy principle. J. Chem. Phys. 138, 094112 (2013).</li>
<li>Camilloni, C., Cavalli, A. &amp; Vendruscolo, M. Replica-Averaged Metadynamics. Journal of Chemical Theory … 9, 5610–5617 (2013).</li>
<li>Roux, B. &amp; Weare, J. On the statistical equivalence of restrained-ensemble simulations with the maximum entropy method. J. Chem. Phys. 138, 084107 (2013).</li>
<li>Boomsma, W., Lindorff-Larsen, K. &amp; Ferkinghoff-Borg, J. Combining Experiments and Simulations Using the Maximum Entropy Principle. PLoS Comput. Biol. 10, e1003406 (2014).</li>
<li>Camilloni, C. &amp; Vendruscolo M. A Tensor-Free Method for the Structural and Dynamical Refinement of Proteins using Residual Dipolar Couplings. J. PHYS. CHEM. B XXX (2014). </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
